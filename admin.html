<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - henrikworld.com</title>

<style>
body {
  font-family: monospace;
  background-color: white;
  color: black;
  margin: 0;
  padding: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  box-sizing: border-box;
}

h1, h2 {
  text-align: center;
  margin-bottom: 20px;
}

.editor-container {
  display: flex;
  width: 100%;
  max-width: 800px;
  height: 150px;
  border: 1px solid #ccc;
  overflow: hidden;
  margin-bottom: 30px;
}

.line-numbers {
  background-color: #f0f0f0;
  padding: 10px;
  text-align: right;
  user-select: none;
  color: #666;
  flex-shrink: 0;
}

#codeArea {
  width: 100%;
  border: none;
  padding: 10px;
  resize: none;
  outline: none;
  font-family: monospace;
  font-size: 14px;
  line-height: 1.4em;
  white-space: pre;
  overflow: auto;
}

button {
  margin-top: 10px;
  padding: 8px 16px;
  font-size: 14px;
  cursor: pointer;
  border: 1px solid #ccc;
  background-color: white;
  color: black;
}

button:hover {
  background-color: #f5f5f5;
}

#requestsContainer {
  width: 100%;
  max-width: 800px;
  border: 1px solid #ccc;
  padding: 10px;
  border-radius: 6px;
  margin-top: 20px;
}

.requestItem {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  padding: 5px;
  border-bottom: 1px solid #eee;
}

.requestItem span {
  font-weight: bold;
}

.requestItem button {
  margin-left: 5px;
  padding: 4px 8px;
  font-size: 12px;
}
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import { 
  getFirestore, collection, addDoc, query, getDocs,
  deleteDoc, doc, setDoc 
} from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAQnIe1Z-CMgyYOhKmfKVbLSall-R7frws",
  authDomain: "henrikworldonline-a726f.firebaseapp.com",
  projectId: "henrikworldonline-a726f",
  storageBucket: "henrikworldonline-a726f.firebasestorage.app",
  messagingSenderId: "1060990020059",
  appId: "1:1060990020059:web:35e9816d249cd32d97dffe",
  measurementId: "G-VQNK4YN1C5"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

function updateLineNumbers() {
  const code = document.getElementById("codeArea").value;
  const lines = code.split("\n").length;
  let numbers = "";
  for (let i = 1; i <= lines; i++) numbers += i + "\n";
  document.getElementById("lineNumbers").textContent = numbers;
}

async function processAdminCommand() {
  const code = document.getElementById("codeArea").value.trim();
  const firstLine = code.split("\n")[0];

  if (!firstLine) return alert("Write a command!");

  // === GRANT VIP ===
  if (/admin\/vip\/grant\/username=/i.test(firstLine)) {
    const username = firstLine.match(/username=(.*)/i)[1].trim();
    try {
      await setDoc(doc(db, "vipUsers", username), {
        username,
        grantedAt: new Date()
      });
      alert(`ðŸŒŸ VIP Granted: ${username}`);
      document.getElementById("codeArea").value = "";
      updateLineNumbers();
    } catch (e) { alert("Failed to grant VIP"); }
    return;
  }

  // === REMOVE VIP ===
  if (/admin\/vip\/remove\/username=/i.test(firstLine)) {
    const username = firstLine.match(/username=(.*)/i)[1].trim();
    try {
      await deleteDoc(doc(db, "vipUsers", username));
      alert(`ðŸš« VIP Removed: ${username}`);
      document.getElementById("codeArea").value = "";
      updateLineNumbers();
    } catch (e) { alert("Failed to remove VIP"); }
    return;
  }

  alert("Unknown command.");
}

async function loadAccountRequests() {
  const container = document.getElementById("requestsList");
  container.innerHTML = "<p>Loading...</p>";

  const q = query(collection(db, "accountRequests"));
  const snapshot = await getDocs(q);

  container.innerHTML = "";
  if (snapshot.empty) return container.innerHTML = "<p>No pending requests.</p>";

  snapshot.forEach(docSnap => {
    const data = docSnap.data();
    const id = docSnap.id;

    const div = document.createElement("div");
    div.className = "requestItem";
    div.innerHTML = `
      <span>${data.firstName} ${data.lastName} (${data.username})</span>
      <div>
        <button class="acceptBtn">Accept</button>
        <button class="rejectBtn">Reject</button>
      </div>
    `;
    container.appendChild(div);

    div.querySelector(".acceptBtn").onclick = async () => {
      await addDoc(collection(db, "accounts"), {
        username: data.username,
        password: data.password,
        timestamp: new Date()
      });
      await deleteDoc(doc(db, "accountRequests", id));
      loadAccountRequests();
      alert(`Accepted ${data.username}`);
    };

    div.querySelector(".rejectBtn").onclick = async () => {
      await deleteDoc(doc(db, "accountRequests", id));
      loadAccountRequests();
      alert(`Rejected ${data.username}`);
    };
  });
}

window.addEventListener("DOMContentLoaded", () => {
  document.getElementById("codeArea").addEventListener("input", updateLineNumbers);
  document.getElementById("saveBtn").addEventListener("click", processAdminCommand);
  updateLineNumbers();
  loadAccountRequests();
});
</script>
</head>

<body>
<h1>Admin Panel</h1>

<div class="editor-container">
  <pre class="line-numbers" id="lineNumbers">1</pre>
  <textarea id="codeArea" placeholder="Write admin commands here..."></textarea>
</div>

<button id="saveBtn">Execute Command</button>

<h2>Pending Account Requests</h2>

<div id="requestsContainer">
  <div id="requestsList"></div>
</div>

</body>
</html>
